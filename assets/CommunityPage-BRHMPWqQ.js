import{b as I,r as u,j as e,U as R,I as A,R as E,T as L,C as O,S as M,c as G,d as F,V as J,L as C,G as _,e as P}from"./index-DDIVCFFy.js";import{s as $}from"./authService-Dkbuwon_.js";const W=({onAddPost:t})=>{const{currentUser:r}=I(),[o,m]=u.useState(""),[h,n]=u.useState(null),f=u.useRef(null),g=i=>{if(i.target.files&&i.target.files[0]){const b=i.target.files[0],j=new FileReader;j.onloadend=()=>{n(j.result)},j.readAsDataURL(b)}},w=i=>{if(i.preventDefault(),!o.trim()||!r)return;const b={id:Date.now(),author:{id:r.id,name:r.name,profilePictureUrl:r.profilePictureUrl},content:o,imageUrl:h||void 0,timestamp:new Date().toISOString(),likes:0,comments:[]};t(b),m(""),n(null),f.current&&(f.current.value="")};return e.jsx("div",{className:"glass-card p-6 mb-8",children:e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:r!=null&&r.profilePictureUrl?e.jsx("img",{src:r.profilePictureUrl,alt:r.name,className:"w-full h-full object-cover"}):e.jsx(R,{className:"w-7 h-7 text-slate-600 dark:text-slate-300"})}),e.jsx("textarea",{value:o,onChange:i=>m(i.target.value),placeholder:`What's on your mind, ${r==null?void 0:r.name.split(" ")[0]}?`,className:"w-full p-3 border border-slate-300/50 dark:border-slate-600/50 bg-white/50 dark:bg-slate-700/50 dark:text-slate-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 resize-none",rows:3})]}),h&&e.jsxs("div",{className:"mt-4 pl-4 sm:pl-16 relative",children:[e.jsx("img",{src:h,alt:"Preview",className:"max-h-60 w-full rounded-lg object-cover"}),e.jsx("button",{onClick:()=>n(null),className:"absolute top-2 right-2 bg-black/50 text-white rounded-full h-7 w-7 flex items-center justify-center font-bold text-lg hover:bg-black/80",children:"Ã—"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pl-4 sm:pl-16",children:[e.jsxs("button",{type:"button",onClick:()=>{var i;return(i=f.current)==null?void 0:i.click()},className:"flex items-center space-x-2 text-orange-600 hover:text-orange-800 dark:hover:text-orange-400 font-semibold",children:[e.jsx(A,{className:"w-6 h-6"}),e.jsx("span",{children:"Add Photo"})]}),e.jsx("input",{type:"file",accept:"image/*",ref:f,onChange:g,className:"hidden"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"bg-orange-500 text-white font-bold py-2 px-8 rounded-full hover:bg-orange-600 transition-colors disabled:bg-orange-300",children:"Post"})]})]})})},Y=({post:t,onUpdatePost:r,onDeletePost:o,onAddComment:m,onAddReply:h})=>{const{currentUser:n}=I(),[f,g]=u.useState(!1),[w,i]=u.useState(t.content),[b,j]=u.useState(!1),[k,y]=u.useState(""),[S,s]=u.useState(null),[d,x]=u.useState(""),p=a=>{const l=Math.floor((new Date().getTime()-new Date(a).getTime())/1e3);let c=l/31536e3;return c>1?Math.floor(c)+"y":(c=l/2592e3,c>1?Math.floor(c)+"mo":(c=l/86400,c>1?Math.floor(c)+"d":(c=l/3600,c>1?Math.floor(c)+"h":(c=l/60,c>1?Math.floor(c)+"m":Math.floor(l)+"s"))))},N=()=>{r(t.id,w),g(!1)},v=a=>{a.preventDefault(),k.trim()&&(m(t.id,k),y(""))},T=(a,l)=>{a.preventDefault(),d.trim()&&(h(t.id,l,d),x(""),s(null))},D=(n==null?void 0:n.id)===t.author.id;return e.jsxs("div",{className:"glass-card overflow-hidden",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.author.profilePictureUrl?e.jsx("img",{src:t.author.profilePictureUrl,alt:t.author.name,className:"w-full h-full object-cover"}):e.jsx(R,{className:"w-7 h-7 text-slate-600 dark:text-slate-300"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-lg",children:t.author.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:p(t.timestamp)})]})]}),D&&e.jsxs("div",{className:"flex space-x-2 text-sm",children:[e.jsx("button",{onClick:()=>g(!0),className:"font-semibold text-slate-600 dark:text-slate-300 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>o(t.id),className:"font-semibold text-red-600 hover:underline",children:"Delete"})]})]}),f?e.jsxs("div",{children:[e.jsx("textarea",{value:w,onChange:a=>i(a.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white/50 dark:bg-slate-700/50",rows:3}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-2",children:[e.jsx("button",{onClick:()=>g(!1),className:"text-sm font-semibold",children:"Cancel"}),e.jsx("button",{onClick:N,className:"text-sm font-bold text-white bg-orange-500 px-3 py-1 rounded-md",children:"Save"})]})]}):e.jsx("p",{className:"text-slate-700 dark:text-slate-300 text-base mb-4 whitespace-pre-wrap",children:t.content})]}),t.imageUrl&&e.jsx("div",{className:"bg-black/10 dark:bg-black/20",children:e.jsx("img",{src:t.imageUrl,alt:"Post content",className:"w-full max-h-[500px] object-cover",loading:"lazy"})}),e.jsxs("div",{className:"px-6 py-3 border-y border-white/20 dark:border-slate-700/50 flex justify-around",children:[e.jsxs("button",{className:"flex items-center space-x-2 text-slate-600 dark:text-slate-300 hover:text-orange-600 font-semibold transition-colors rounded-lg px-4 py-2 hover:bg-orange-50/50 dark:hover:bg-slate-700/50",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsxs("span",{children:["Like (",t.likes,")"]})]}),e.jsxs("button",{onClick:()=>j(!b),className:"flex items-center space-x-2 text-slate-600 dark:text-slate-300 hover:text-orange-600 font-semibold transition-colors rounded-lg px-4 py-2 hover:bg-orange-50/50 dark:hover:bg-slate-700/50",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsxs("span",{children:["Comment (",t.comments.length,")"]})]})]}),b&&e.jsxs("div",{className:"p-6 bg-black/5 dark:bg-black/10",children:[n&&e.jsxs("form",{onSubmit:v,className:"flex items-center space-x-3 mb-6",children:[e.jsx("img",{src:n.profilePictureUrl,alt:"You",className:"w-9 h-9 rounded-full object-cover"}),e.jsx("input",{type:"text",value:k,onChange:a=>y(a.target.value),placeholder:"Write a comment...",className:"w-full p-2 border border-slate-300/50 dark:border-slate-600/50 bg-white/50 dark:bg-slate-700/50 rounded-full focus:ring-2 focus:ring-orange-500"}),e.jsx("button",{type:"submit",className:"bg-orange-500 text-white rounded-full p-2 hover:bg-orange-600",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"space-y-4",children:t.comments.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("img",{src:a.author.profilePictureUrl,alt:a.author.name,className:"w-9 h-9 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"bg-slate-100/70 dark:bg-slate-700/70 p-3 rounded-xl",children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-sm",children:a.author.name}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:a.text})]}),e.jsx("button",{onClick:()=>s(S===a.id?null:a.id),className:"text-xs font-semibold text-slate-600 dark:text-slate-400 mt-1 hover:underline",children:"Reply"})]})]}),a.replies.map(l=>e.jsxs("div",{className:"flex items-start space-x-3 ml-12 mt-3",children:[e.jsx("img",{src:l.author.profilePictureUrl,alt:l.author.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsx("div",{children:e.jsxs("div",{className:"bg-slate-100/70 dark:bg-slate-700/70 p-2 rounded-xl",children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-xs",children:l.author.name}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 text-sm",children:l.text})]})})]},l.id)),S===a.id&&n&&e.jsxs("form",{onSubmit:l=>T(l,a.id),className:"flex items-center space-x-3 ml-12 mt-3",children:[e.jsx("img",{src:n.profilePictureUrl,alt:"You",className:"w-8 h-8 rounded-full object-cover"}),e.jsx("input",{type:"text",value:d,onChange:l=>x(l.target.value),placeholder:`Reply to ${a.author.name}...`,className:"w-full p-2 border border-slate-300/50 dark:border-slate-600/50 bg-white/50 dark:bg-slate-700/50 rounded-full focus:ring-2 focus:ring-orange-500",autoFocus:!0})]})]},a.id))})]})]})},z=E.memo(Y),U="petbhai_posts",K=()=>{try{const t=window.localStorage.getItem(U);return t?JSON.parse(t):(window.localStorage.setItem(U,JSON.stringify(P)),P)}catch(t){return console.error("Error reading posts from localStorage",t),P}},H=()=>{const{isAuthenticated:t,socialLogin:r,currentUser:o}=I(),[m,h]=u.useState(K),[n,f]=u.useState(!1),g=G(),{confirm:w}=F();u.useEffect(()=>{try{window.localStorage.setItem(U,JSON.stringify(m))}catch(s){console.error("Error writing posts to localStorage",s)}},[m]);const i=s=>{h(d=>[s,...d])},b=(s,d)=>{h(m.map(x=>x.id===s?{...x,content:d}:x))},j=async s=>{await w({title:"Delete Post?",message:"Are you sure you want to delete this post? This action cannot be undone."})&&(h(m.filter(x=>x.id!==s)),g.success("Post deleted successfully."))},k=(s,d)=>{if(!o)return;const x={id:Date.now(),author:{id:o.id,name:o.name,profilePictureUrl:o.profilePictureUrl},text:d,replies:[]};h(m.map(p=>p.id===s?{...p,comments:[...p.comments,x]}:p))},y=(s,d,x)=>{if(!o)return;const p={id:Date.now(),author:{id:o.id,name:o.name,profilePictureUrl:o.profilePictureUrl},text:x};h(m.map(N=>N.id===s?{...N,comments:N.comments.map(v=>v.id===d?{...v,replies:[...v.replies,p]}:v)}:N))},S=async()=>{f(!0);try{const s=await $();await r(s)}catch(s){const d=s instanceof Error?s.message:"An unknown error occurred.";console.error("Google Sign-In failed",s),g.error(`Failed to sign in with Google: ${d}`)}finally{f(!1)}};return e.jsxs("div",{className:"container mx-auto px-6 py-12 max-w-3xl animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-4xl font-bold text-slate-800 dark:text-white",children:"Community Hub"}),e.jsx("p",{className:"text-lg text-slate-700 dark:text-slate-200 mt-2",children:"Share pet care tips, product reviews, and connect with fellow pet lovers."})]}),e.jsxs("div",{className:"glass-card p-6 mb-8 flex flex-col sm:flex-row items-center justify-between gap-4 bg-gradient-to-r from-slate-100 to-orange-50 dark:from-slate-800 dark:to-slate-900 border border-orange-200 dark:border-orange-900/30",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center justify-center sm:justify-start gap-2",children:[e.jsx(J,{className:"w-6 h-6 text-orange-500"}),"Creator Tools"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mt-1 text-sm",children:"Starting a pet vlog? Create custom thumbnails instantly."})]}),e.jsx(C,{to:"/thumbnail-generator",className:"whitespace-nowrap px-6 py-2.5 bg-orange-500 text-white font-bold rounded-full hover:bg-orange-600 transition-colors shadow-md",children:"Create Thumbnail"})]}),t?e.jsx(W,{onAddPost:i}):e.jsxs("div",{className:"glass-card p-8 mb-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:"Join the Conversation!"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-200 mb-6",children:"Sign in to share your stories and connect with our community."}),e.jsx("div",{className:"space-y-4 max-w-sm mx-auto",children:e.jsxs("button",{onClick:S,disabled:n,className:"w-full flex items-center justify-center space-x-3 py-3 px-4 border border-slate-300 dark:border-slate-500 rounded-lg hover:bg-slate-50/50 dark:hover:bg-slate-700/50 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[e.jsx(_,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:n?"Signing in...":"Sign in with Google"})]})}),e.jsxs("div",{className:"flex items-center my-6",children:[e.jsx("div",{className:"flex-grow border-t border-slate-300 dark:border-slate-600"}),e.jsx("span",{className:"flex-shrink mx-4 text-slate-500 dark:text-slate-400 font-semibold text-sm",children:"OR"}),e.jsx("div",{className:"flex-grow border-t border-slate-300 dark:border-slate-600"})]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-300",children:[e.jsx(C,{to:"/login",className:"font-semibold text-orange-600 hover:underline",children:"Log in with email"})," ","or"," ",e.jsx(C,{to:"/signup",className:"font-semibold text-orange-600 hover:underline",children:"sign up"}),"."]})]}),e.jsx("div",{className:"space-y-8",children:m.map(s=>e.jsx(z,{post:s,onUpdatePost:b,onDeletePost:j,onAddComment:k,onAddReply:y},s.id))})]})};export{H as default};
