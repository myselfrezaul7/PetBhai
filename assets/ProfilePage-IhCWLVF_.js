import{d as T,k as A,u as U,i as O,g as q,r as l,j as e,U as y,L as u}from"./index-Dp4w8mxu.js";import{P as B}from"./ProductCard-DiIX-qpR.js";const V=15,z=()=>{const{currentUser:a,updateProfile:P,isAuthenticated:g}=T(),{addToCart:S}=A(),{products:f}=U(),p=O(),D=q(),[c,C]=l.useState((a==null?void 0:a.name)||""),[n,R]=l.useState((a==null?void 0:a.profilePictureUrl)||null),[E,M]=l.useState(null),[b,j]=l.useState(!1),[N,o]=l.useState(""),[v,x]=l.useState(""),[i,I]=l.useState("profile"),w=l.useRef(null);l.useEffect(()=>{g||p("/login")},[g,p]);const h=l.useMemo(()=>a?f.filter(s=>a.wishlist.includes(s.id)):[],[a,f]),k=l.useMemo(()=>{if(!a)return[];const s=new Date;return s.setDate(s.getDate()-V),a.orderHistory.filter(t=>new Date(t.date)<s)},[a]),L=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){M(t);const m=new FileReader;m.onloadend=()=>{R(m.result)},m.readAsDataURL(t)}},F=async s=>{if(s.preventDefault(),!!a){j(!0),o(""),x("");try{let t={};c!==a.name&&(t.name=c),E&&n&&(t.profilePictureUrl=n),Object.keys(t).length>0?(await P(t),o("Profile updated successfully!")):o("No changes to save."),setTimeout(()=>o(""),3e3)}catch(t){const r=t instanceof Error?t.message:"An unknown error occurred.";x(r),setTimeout(()=>x(""),5e3)}finally{j(!1)}}},H=s=>{s.items.forEach(t=>{for(let r=0;r<t.quantity;r++)S(t)}),D.success("Items from your past order have been added to your cart!")};if(!a)return null;const d=({tabId:s,children:t})=>e.jsx("button",{onClick:()=>I(s),className:`px-4 py-2 font-semibold rounded-t-lg transition-colors text-sm sm:text-base ${i===s?"bg-white/30 dark:bg-slate-800/30 border-b-2 border-orange-500 text-orange-600 dark:text-orange-400":"text-slate-600 dark:text-slate-300"}`,children:t});return e.jsx("div",{className:"container mx-auto px-6 py-12 animate-fade-in",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"glass-card p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start text-center sm:text-left space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden ring-4 ring-orange-200 dark:ring-orange-500/30",children:a.profilePictureUrl?e.jsx("img",{src:a.profilePictureUrl,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(y,{className:"w-16 h-16 text-slate-600 dark:text-slate-300"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:a.name}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:a.email})]}),a.isPlusMember?e.jsxs("div",{className:"bg-gradient-to-tr from-yellow-400 to-orange-500 text-white rounded-lg px-4 py-2 text-center",children:[e.jsx("p",{className:"font-bold text-lg",children:"PLUS Member"}),e.jsx("p",{className:"text-xs",children:"Enjoying exclusive benefits!"})]}):e.jsxs(u,{to:"/plus-membership",className:"bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-white rounded-lg px-4 py-2 text-center hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",children:[e.jsx("p",{className:"font-bold text-lg",children:"Join PetBhai+"}),e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400",children:"Unlock Benefits"})]})]})}),e.jsxs("div",{className:"border-b border-slate-300/50 dark:border-slate-600/50 mb-6 flex flex-wrap",children:[e.jsx(d,{tabId:"profile",children:"Edit Profile"}),e.jsxs(d,{tabId:"wishlist",children:["Wishlist (",h.length,")"]}),e.jsxs(d,{tabId:"orders",children:["Orders (",a.orderHistory.length,")"]}),e.jsx(d,{tabId:"reorder",children:"Reorder"})]}),e.jsxs("div",{className:"glass-card p-8 md:p-10",children:[i==="profile"&&e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:n?e.jsx("img",{src:n,alt:"Profile Preview",className:"w-full h-full object-cover"}):e.jsx(y,{className:"w-20 h-20 text-slate-600 dark:text-slate-300"})}),e.jsx("button",{type:"button",onClick:()=>{var s;return(s=w.current)==null?void 0:s.click()},className:"absolute -bottom-2 -right-2 bg-orange-500 text-white rounded-full p-2 hover:bg-orange-600 shadow-md","aria-label":"Change profile picture",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),e.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z",clipRule:"evenodd"})]})}),e.jsx("input",{type:"file",ref:w,onChange:L,accept:"image/*",className:"hidden"})]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Click the pencil to change your photo."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-base font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Full Name"}),e.jsx("input",{type:"text",id:"name",value:c,onChange:s=>C(s.target.value),required:!0,className:"w-full p-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white/50 dark:bg-slate-700/50"})]}),N&&e.jsx("p",{className:"bg-green-100/80 text-green-800 p-3 rounded-lg text-center",children:N}),v&&e.jsx("p",{className:"bg-red-100/80 text-red-700 p-3 rounded-lg text-center",children:v}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg text-lg hover:bg-orange-600 transition-colors disabled:bg-orange-300",children:b?"Saving Changes...":"Save Changes"})})]}),i==="wishlist"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-slate-800 dark:text-white",children:"My Wishlist"}),h.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(s=>e.jsx(B,{product:s},s.id))}):e.jsxs("p",{className:"text-slate-600 dark:text-slate-300",children:["Your wishlist is empty."," ",e.jsx(u,{to:"/shop",className:"text-orange-600 hover:underline",children:"Explore products!"})]})]}),i==="orders"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-slate-800 dark:text-white",children:"My Order History"}),a.orderHistory.length>0?e.jsx("div",{className:"space-y-4",children:a.orderHistory.map(s=>e.jsxs("div",{className:"border border-slate-300/50 dark:border-slate-600/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-2",children:[e.jsxs("p",{className:"font-bold text-slate-800 dark:text-white",children:["Order: ",s.orderId]}),e.jsxs("p",{className:"font-semibold text-slate-800 dark:text-white",children:["Total: ৳",s.total.toFixed(2)]})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:["Date: ",new Date(s.date).toLocaleDateString()]}),e.jsx("ul",{className:"text-sm space-y-1",children:s.items.map(t=>e.jsxs("li",{className:"flex justify-between text-slate-600 dark:text-slate-300",children:[e.jsxs("span",{children:[t.name," (x",t.quantity,")"]}),e.jsxs("span",{children:["৳",(t.price*t.quantity).toFixed(2)]})]},t.id))})]},s.orderId))}):e.jsxs("p",{className:"text-slate-600 dark:text-slate-300",children:["You haven't made any purchases yet."," ",e.jsx(u,{to:"/shop",className:"text-orange-600 hover:underline",children:"Visit the shop!"})]})]}),i==="reorder"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-slate-800 dark:text-white",children:"Smart Reorder Suggestions"}),k.length>0?e.jsx("div",{className:"space-y-4",children:k.map(s=>e.jsxs("div",{className:"border border-slate-300/50 dark:border-slate-600/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:["From your order on ",new Date(s.date).toLocaleDateString(),":"]}),e.jsx("ul",{className:"text-sm space-y-1 mb-4",children:s.items.map(t=>e.jsxs("li",{className:"flex items-center text-slate-600 dark:text-slate-300",children:[e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-8 h-8 rounded-sm object-cover mr-2"}),e.jsxs("span",{children:[t.name," (x",t.quantity,")"]})]},t.id))}),e.jsx("button",{onClick:()=>H(s),className:"w-full sm:w-auto bg-orange-500 text-white font-bold py-2 px-4 rounded-lg text-sm hover:bg-orange-600 transition-colors",children:"Add to Cart"})]},s.orderId))}):e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"No reorder suggestions right now. We'll suggest items here when it's time to restock!"})]})]})]})})};export{z as default};
