import{r as o,b as y,j as e,C as k,P as v,T as I,S}from"./index-Dcgow4CU.js";import{g as C}from"./geminiService-BpbN5b-k.js";const m="petbhai_ai_chat_history",N="petbhai_ai_warning_dismissed",A=({text:t})=>{const n=t.split(`
`),l=[];let d=!1,i=[];const x=r=>r.split(/(\*\*.*?\*\*|\[.*?\]\(.*?\))/g).map((a,g)=>{if(a.startsWith("**")&&a.endsWith("**"))return e.jsx("strong",{children:a.slice(2,-2)},g);if(a.startsWith("[")&&a.includes("](")&&a.endsWith(")")){const[u,f]=a.slice(1,-1).split("](");return e.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 dark:text-orange-400 underline hover:text-orange-800",children:u},g)}return a}),h=r=>{i.length>0&&(l.push(e.jsx("ul",{className:"list-disc pl-5 space-y-1 mt-2",children:i},`ul-${r}`)),i=[]),d=!1};return n.forEach((r,c)=>{if(r.trim().startsWith("* ")){const a=r.trim().substring(2);i.push(e.jsx("li",{children:x(a)},c)),d=!0}else d&&h(c),r.trim()!==""&&l.push(e.jsx("p",{className:"mt-2 first:mt-0",children:x(r)},c))}),d&&h(n.length),e.jsx(e.Fragment,{children:l})},T=()=>{try{const t=window.localStorage.getItem(m);if(t){const n=JSON.parse(t);if(Array.isArray(n))return n}}catch(t){console.error("Error reading chat history from localStorage",t),window.localStorage.removeItem(m)}return[]},R=()=>{const[t,n]=o.useState(T),[l,d]=o.useState(""),[i,x]=o.useState(!1),[h,r]=o.useState(!1),c=o.useRef(null),{confirm:a}=y();o.useEffect(()=>{sessionStorage.getItem(N)||r(!0)},[]),o.useEffect(()=>{var s;(s=c.current)==null||s.scrollIntoView({behavior:"smooth"})},[t]),o.useEffect(()=>{try{t.length>0?window.localStorage.setItem(m,JSON.stringify(t)):window.localStorage.removeItem(m)}catch(s){console.error("Error saving chat history to localStorage",s)}},[t]);const g=()=>{sessionStorage.setItem(N,"true"),r(!1)},u=async s=>{if(s.preventDefault(),!l.trim()||i)return;const p={sender:"user",text:l};n(b=>[...b,p]),d(""),x(!0);try{const j={sender:"ai",text:await C(l)};n(w=>[...w,j])}catch{const j={sender:"ai",text:"Oops! Something went wrong. Please try again."};n(w=>[...w,j])}finally{x(!1)}},f=async()=>{await a({title:"Clear Chat History?",message:"Are you sure you want to clear the entire chat history? This action cannot be undone."})&&n([])};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-72px)] container mx-auto p-4 max-w-3xl animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-6 pt-4",children:[e.jsx("h1",{className:"text-4xl font-bold text-slate-800 dark:text-white",children:"AI Vet"}),e.jsx("p",{className:"text-lg text-slate-700 dark:text-slate-200",children:"Ask general questions about pet health and care."})]}),h&&e.jsxs("div",{className:"animate-fade-in glass-card p-4 mb-4 flex items-start space-x-4 bg-orange-100/50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-500/30",children:[e.jsx("div",{className:"flex-shrink-0 text-orange-500 mt-1",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.852-1.21 3.488 0l6.233 11.916c.638 1.213-.466 2.735-1.744 2.735H3.768c-1.278 0-2.382-1.522-1.744-2.735L8.257 3.099zM10 12a1 1 0 110-2 1 1 0 010 2zm0-5a1 1 0 011 1v2a1 1 0 11-2 0V8a1 1 0 011-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"font-bold text-orange-800 dark:text-orange-200",children:"For First-Aid & Info Only"}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 mt-1",children:["This is an AI assistant, NOT a real veterinarian. The advice provided is for general guidance and emergency first-aid purposes only. For any health concerns, you ",e.jsx("strong",{children:"must"})," consult a licensed, in-person veterinarian."]})]}),e.jsx("button",{onClick:g,className:"p-1 rounded-full text-orange-600 dark:text-orange-300 hover:bg-orange-200/50 dark:hover:bg-orange-800/50","aria-label":"Dismiss warning",children:e.jsx(k,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"glass-card flex-grow flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-6","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-orange-500 p-2 rounded-full text-white flex-shrink-0",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("div",{className:"bg-slate-100/70 dark:bg-slate-700/70 p-4 rounded-xl rounded-tl-none max-w-lg",children:e.jsx("p",{className:"text-slate-800 dark:text-slate-200",children:"Hello! I'm PetBhai's AI Vet. How can I help you with your pet today?"})})]}),t.map((s,p)=>e.jsxs("div",{className:`flex items-start gap-3 ${s.sender==="user"?"justify-end":""}`,children:[s.sender==="ai"&&e.jsx("div",{className:"bg-orange-500 p-2 rounded-full text-white flex-shrink-0",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("div",{className:`p-4 rounded-xl max-w-lg ${s.sender==="user"?"bg-orange-500 text-white rounded-br-none":"bg-slate-100/70 dark:bg-slate-700/70 text-slate-800 dark:text-slate-200 rounded-tl-none"}`,children:s.sender==="ai"?e.jsx(A,{text:s.text}):e.jsx("p",{children:s.text})})]},p)),i&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-orange-500 p-2 rounded-full text-white",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("div",{className:"bg-slate-100/70 dark:bg-slate-700/70 p-4 rounded-xl rounded-tl-none",children:e.jsxs("div",{className:"flex items-center space-x-2 text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"w-2 h-2 bg-slate-500 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-slate-500 rounded-full animate-pulse [animation-delay:0.2s]"}),e.jsx("div",{className:"w-2 h-2 bg-slate-500 rounded-full animate-pulse [animation-delay:0.4s]"}),e.jsx("span",{children:"Thinking & Searching..."})]})})]}),e.jsx("div",{ref:c})]})}),e.jsxs("div",{className:"p-4 bg-black/5 dark:bg-black/10 border-t border-white/20 dark:border-slate-700/50",children:[t.length>0&&e.jsx("div",{className:"text-center mb-2",children:e.jsxs("button",{onClick:f,className:"inline-flex items-center space-x-1.5 text-sm text-slate-500 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-500 transition-colors px-3 py-1 rounded-md hover:bg-red-500/10",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Clear Chat"})]})}),e.jsxs("form",{onSubmit:u,className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:l,onChange:s=>d(s.target.value),placeholder:"Ask a question about pet care...",className:"flex-grow p-3 border border-slate-300 dark:border-slate-600 rounded-full focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white/50 dark:bg-slate-700/50 dark:text-slate-200",disabled:i}),e.jsx("button",{type:"submit",disabled:i||!l.trim(),className:"bg-orange-500 text-white rounded-full p-3 hover:bg-orange-600 disabled:bg-orange-300 disabled:cursor-not-allowed transition-colors","aria-label":"Send message",children:e.jsx(S,{className:"w-6 h-6"})})]})]})]})]})};export{R as default};
